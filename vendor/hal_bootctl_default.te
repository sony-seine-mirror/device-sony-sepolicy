# These are the permissions required to use the boot_control HAL implemented
# here: hardware/qcom/bootctrl/boot_control.c

# Getting and setting GPT attributes for the bootloader iterates over all the
# partition names in the block_device directory /dev/block/.../by-name
allow hal_bootctl_default block_device:dir r_dir_perms;

# Edit the attributes stored in the GPT.
allow hal_bootctl_default block_device:blk_file getattr;
allow hal_bootctl_default boot_block_device:blk_file rw_file_perms;
allow hal_bootctl_default misc_block_device:blk_file rw_file_perms;
allow hal_bootctl_default root_block_device:blk_file rw_file_perms;
allow hal_bootctl_default ab_block_device:blk_file getattr;
allow hal_bootctl_default modem_block_device:blk_file getattr;
allow hal_bootctl_default system_block_device:blk_file getattr;
allow hal_bootctl_default ramdump_block_device:blk_file getattr;
allow hal_bootctl_default adsprpcd_block_device:blk_file getattr;
allow hal_bootctl_default dtbo_block_device:blk_file getattr;
allow hal_bootctl_default vbmeta_block_device:blk_file getattr;

# Write to the XBL devices.
allow hal_bootctl_default xbl_block_device:blk_file rw_file_perms;

allow update_engine dtbo_block_device:blk_file { open read write };

# 2021-04-02 14:39:39.435 965-965/? W/update_engine: type=1400 audit(0.0:98): avc: denied { read } for name="mmcblk0p76" dev="tmpfs" ino=20555 scontext=u:r:update_engine:s0 tcontext=u:object_r:vbmeta_block_device:s0 tclass=blk_file permissive=0
allow update_engine vbmeta_block_device:blk_file { open read write };

# 2021-04-02 15:47:53.804 4377-4377/? W/otapreopt_chroo: type=1400 audit(0.0:126): avc: denied { ioctl } for path="/dev/block/loop27" dev="tmpfs" ino=57481 ioctlcmd=0x4c0a scontext=u:r:otapreopt_chroot:s0 tcontext=u:object_r:loop_device:s0 tclass=blk_file permissive=0
# allow otapreopt_chroo loop_device:blk_file ioctl;
